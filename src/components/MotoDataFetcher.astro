---
import MotoListReact from "./MotoListReact";
import { brandsService } from "../services/api/brands.service";
import { categoriesService } from "../services/api/categories.service";
import { motoService } from "../services/api/moto.service";
import type { Brand } from "../types/brand.interface";
import type { Category } from "../types/category.interface";
import type { Moto } from "../types/moto.interface";

// Logs iniciales
console.log("üöÄ MotoDataFetcher.astro iniciando...");
console.log("üìå API URL:", import.meta.env.PUBLIC_API_URL);

let brands: Brand[] = [];
let categories: Category[] = [];
let motos: Moto[] = [];

try {
  console.log("üîÑ Iniciando fetch de datos...");

  // Fetch brands
  try {
    brands = await brandsService.getBrands();
    console.log("‚úÖ Brands obtenidos:", brands.length);
  } catch (error) {
    console.error("‚ùå Error obteniendo brands:", error);
    brands = [];
  }

  // Fetch categories
  try {
    categories = await categoriesService.getCategories();
    console.log("‚úÖ Categories obtenidas:", categories.length);
  } catch (error) {
    console.error("‚ùå Error obteniendo categories:", error);
    categories = [];
  }

  // Fetch motos
  try {
    motos = await motoService.getMotos();
    console.log("‚úÖ Motos obtenidas:", motos.length);
  } catch (error) {
    console.error("‚ùå Error obteniendo motos:", error);
    motos = [];
  }

  console.log("‚úÖ Datos totales obtenidos:", {
    brands: brands.length,
    categories: categories.length,
    motos: motos.length,
  });
} catch (error) {
  console.error("‚ùå Error general en el fetch de datos:", error);
  brands = [];
  categories = [];
  motos = [];
}
---

<MotoListReact
  client:load
  initialBrands={brands}
  initialCategories={categories}
  initialMotos={motos}
/>
