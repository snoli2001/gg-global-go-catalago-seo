---
import MotoListReact from "./MotoListReact";
import { brandsService } from "../services/api/brands.service";
import { categoriesService } from "../services/api/categories.service";
import { motoService } from "../services/api/moto.service";
import type { Brand } from "../types/brand.interface";
import type { Category } from "../types/category.interface";
import type { Moto } from "../types/moto.interface";

// Logs iniciales
console.warn("ğŸš€ MotoDataFetcher.astro iniciando...");
console.warn("ğŸ“Œ API URL:", import.meta.env.PUBLIC_API_URL);

let brands: Brand[] = [];
let categories: Category[] = [];
let motos: Moto[] = [];

try {
  console.warn("ğŸ”„ Iniciando fetch de datos...");
  // Fetch all data at server side
  [brands, categories, motos] = await Promise.all([
    brandsService.getBrands(),
    categoriesService.getCategories(),
    motoService.getMotos(),
  ]);
  console.warn("âœ… Datos obtenidos exitosamente:", {
    brands: brands.length,
    categories: categories.length,
    motos: motos.length,
  });
} catch (error) {
  console.warn("âŒ Error obteniendo datos:", error);
  // Proporcionar datos vacÃ­os en caso de error
  brands = [];
  categories = [];
  motos = [];
}

console.warn("ğŸ¯ Renderizando componente con datos...");
---

<MotoListReact
  client:load
  initialBrands={brands}
  initialCategories={categories}
  initialMotos={motos}
/>

<script>
  console.warn("ğŸ“ Script del cliente ejecutÃ¡ndose en MotoDataFetcher...");
</script>

